1. [운영체제란](#운영체제란)
    - [운영체제 정의](#운영체제-정의)

2. [프로세스 vs 스레드](#프로세스-vs-스레드)
    - [프로세스란?](#프로세스란)
        - [프로세스의 특징](#프로세스의-특징)
    - [스레드란?](#스레드란)
        - [스레드의 특징](#스레드의-특징)
    - [프로세스 주소 공간](#프로세스-주소-공간)

3. [멀티스레드](#멀티스레드)
    - [멀티스레드 정의](#멀티스레드-정의)
    - [멀티스레드의 장점](#멀티스레드의-장점)
    - [멀티스레드의 단점](#멀티스레드의-단점)

4. [인터럽트](#인터럽트)
    - [인터럽트 정의](#인터럽트-정의)
    - [Timer Interrupt](#timer-interrupt)
    - [I/O Interrupt](#io-interrupt)

5. [시스템 콜](#시스템-콜)
    - [시스템 콜 개요](#시스템-콜-개요)
    - [시스템 콜의 예시](#시스템-콜의-예시)

6. [PCB와 Context Switching](#pcb와-context-switching)
    - [Process MetaData](#process-metadata)
    - [PCB (Process Control Block)](#pcb-process-control-block)
    - [Context Switching](#context-switching)

7. [IPC (Inter Process Communication)](#ipc-inter-process-communication)
    - [IPC 개요](#ipc-개요)
    - [IPC 통신 모델](#ipc-통신-모델)
    - [IPC 설비](#ipc-설비)

## 운영체제란
### 운영체제 정의
- 운영체제(Operating System)는 컴퓨터 시스템의 **하드웨어적인 자원과 소프트웨어적인 자원을 효율적으로 관리**함으로써 사용자가 컴퓨터를 편리하고, 효과적으로 사용할 수 있도록 환경을 제공하는 시스템 소프트웨어를 말한다.
- 컴퓨터 사용자와 컴퓨터 하드웨어 간의 **인터페이스**로서 동작하는 시스템 소프트웨어의 일종으로, 다른 응용 프로그램이 유용한 작업을 할 수 있도록 환경을 제공해준다.



## 프로세스 vs 스레드
### 프로세스란?
- 사전적 의미 : 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
	- 메모리에 올라와 있는 프로그램의 인스턴스(독립적인 개체)
	- 운영체제로부터 시스템을 할당받는 자원의 단위
#### 프로세스의 특징
- 각각의 독립된 메모리 영역(Code, Data, Stack, Heap)을 할당받음
- 기본적으로 프로세스당 최소 1개의 스레드를 가지고 있다.
- 각 프로세스는 별도의 주소공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근 X
- 한 프로세스가 다르 프로세스의 자원에 접근하려면 프로세스 간의 통신(IPC)을 사용해야한다.

### 스레드란?
- 사전적 의미 : 프로세스 내에서 실행되는 여러 흐름의 단위
	- 프로세스의 특정한 수행 경로
	- 프로세스가 할당받은 자원을 이용하는 실행의 단위

#### 스레드의 특징
- 스레드는 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유
 - 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름으로, 프로세스 내의 주소 공간이나 자원들(힙 공간 등)을 같은 프로세스 내에 스레드끼리 공유하면서 실행
- 같은 프로세스 안에 있는 여러 스레드들은 같은 힙 공간을 공유한다. 반면에 프로세스는 다른 프로세스의 메모리에 직접 접근 X
 - 각각의 스레드는 별도의 레지스터와 스택을 갖고 있지만, 힙 메모리는 서로 읽고 쓸 수 있다.
- 한 스레드가 프로세스 자원을 변경하면, 다른 이웃 스레드(sibling thread)도 그 변경 결과를 즉시 볼 수 있다.


## 프로세스 주소 공간
![](https://i.imgur.com/QMkl6vC.png)

### Stack 영역
- 함수의 호출과 관계없는 지역변수와 매개변수가 저장되는 영역
- Stack 영역의 값은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸
- 메모리의 높은 주소에서 낮은 주소의 방향으로 할당
- 재귀 함수가 너무 깊게 호출되거나 함수가 지역변수를 너무 많이 가지고 있어 stack 영역을 초과하면 stack overflow 에러가 발생

### Heap 영역
- **런타임에 크기가 결정되는** 영역
- 사용자에 의해 공간이 동적으로 할당 및 해제
- 주로 참조형 데이터 (ex. 클래스) 등의 데이터가 할당
- 메모리의 낮은 주소에서 높은 주소의 방향으로 할당

### Data 영역
- 전역 변수나 Static 변수 등 프로그램이 사용할 수 있는 데이터를 저장하는 영역
- 어떤 프로그램에 전역/static 변수를 참조하는 코드가 존재한다면, 이 프로그램은 컴파일 된 후에 data 영역을 참조
- 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸

### Text 영역
- 프로그램이 실행될 수 있도록 CPU가 해석 가능한 기계어 코드가 저장되어 있는 공간으로, 프로그램이 수정되면 안 되므로 ReadOnly 상태로 저장

### Stack 영역과 Data 영역을 나누는 이유
- Stack 영역을 통해 함수의 흐름을 관리하고, Data 영역 (+BSS 영역)을 통해 전역 변수, static 변수를 관리
- 함수는 결국 스택방식으로 작동하기 때문에, 각 함수의 지역변수를 스택으로 관리하고 어디서나 접근가능해야하는 전역변수는 Data 영역에서 따로 관리
- **최대한 데이터를 공유하여 메모리 사용량을 줄인다**

## 멀티스레드
### 정의 
- **싱글스레드** :  한 프로세스가 하나의 스레드를 이용하여 한 번에 한 작업만 수행하는 것
- **멀티스레드*** : 한 프로세스가 여러 스레드로 동시에 여러 작업을 수행하는 것

1. 프로세스가 여러 개인 경우 멀티 스레드를 통해 병렬성(Parallelism)을 높일 수 있다.
	1. 즉, 여러 작업이 동시에 수행될 수 있다. 이는 프로세스의 각 스레드들이 각각 다른 프로세서에서 병렬적으로 수행될 수 있기 때문이다.
2. 프로세서가 하나인 경우에 멀티 스레드를 통해 동시성(Concurrency)를 높일 수 있다.

### 장점

- 멀티 프로세스에 비해 메모리 자원소모가 줄어듭니다.
- 힙 영역을 통해서 스레드간 통신이 가능해서 프로세스간 통신보다 간단합니다.
- 스레드의 컨텍스트 스위칭은 프로세스의 컨텍스트 스위칭보다 빠릅니다.

### 단점

- 힙 영역에 있는 자원을 사용할 때는 동기화를 해야합니다.
- 동기화를 위해서 락을 과도하게 사용하면 성능이 저하될 수 있습니다.
- 하나의 스레드가 비정상적으로 동작하면 다른 스레드도 종료될 수 있습니다.


## 인터럽트
### 인터럽트(Interrupt)란?
> 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우 현재 실행 중인 작업을 즉시 중단하고, 발생된 상황에 대한 우선 처리가 필요함을 CPU에게 알리는 것

외부/내부 인터럽트는 CPU의 하드웨어 신호에 의해 발생. 다음 명령어로 return

소프트웨어 인터럽트는 명령어의 수행에 의해 발생


![](https://i.imgur.com/xtEPxek.jpg)


### Timer Interrupt

OS는 인터럽트가 발생하기 전까지 프로세스의 제어권을 가져올 수 있는 방법이 거의 없다.

프로세스가 끝나거나, 시스템콜을 호출하여 직접 제어권을 놓지않으면 OS가 간섭을 못하게 되고 프로세스는 영원히 혼자서 실행될 수도 있다.

이러한 것을 위해 timer interrupt를 사용하기 시작했고, 적절한 타이밍마다 타이머 인터럽트를 발생시킴으로써 OS는 제어권을 가져올 수 있다.

###  I/O Interrupt
- Ctrl+C 누르기
- 네트워크에서 패킷 도착
- 디스크에서 데이터 도착

##  시스템 콜
- Trap 의 에시

![](https://i.imgur.com/zdsd1Qm.jpg)

fork( ), exec( ), wait( )와 같은 것들은 Process 생성과 제어를 위한 System call임.

- fork, exec는 새로운 Process 생성과 관련이 되어 있다.
- wait는 Process (Parent)가 만든 다른 Process(child) 가 끝날 때까지 기다리는 명령어임.
## PCB와 Contest Switching
> CPU에 프로세스가 여러 개일 때, CPU 스케줄링을 통해  이를 관리하는 것

CPU는 각 프로세스들이 누군지 알아야 관리가 가능.
### Process MetaData
1. Process ID(PID)
2. Process State
	1. read, running, waiting 등의 상태정보
3. Process Priority
4. CPU registers
5. 포로그램 카운터
	1. 프로세스가 다음에 실행 해야할 명령어의 주소
등등

### PCB(Process Control Block)
![](https://i.imgur.com/Bo11v5x.png)
- 프로세스 메타 데이터들을 저장해놓는 곳
- 하나의 PCB 안에는 하나의 프로세스의 정보가 담겨있다.

**프로그램 실행 -> 프로세스 생성 -> 프로세스 주소 공간에 (코드, 데이터, 스택) 생성 -> 이 프로세스의 메타데이터들이 PCB에 저장**

#### PCB가 필요한 이유?
CPU에서는 프로세스의 상태에 따라 교체 작업이 이루어집니다. (인터럽트가 발생해서 할당받은 프로세스가 Block 상태가 되고 다른 프로세스를 running으로 바꿀 때)

**이때, 앞으로 다시 수행할 Block 상태의 프로세스의 상태값을 PCB에 저장해두는 것**입니다.

#### PCB의 관리 방식
Linked List 방식으로 관리가 됨
### Context Switching
- **다양한 사람들이 동시에 사용하는 것처럼 하기 위해서** Context Switching 도입
- OS 커널에서 일어남
- 인터럽트가 발생하거나, 실행 중인 CPU 사용 허가 시간을 모두 소모하거나, 입출력을 위해 대기해야 하는 경우 Context Switching이 발생
- Context Switching 비용은 Process가 Thread보다 많이 든다!

## IPC(Inter Process Communication)
### IPC란?
독립적 구조를 가진 **프로세스 간의 통신**

### IPC 통신 모델
#### Messaging passing(메시지 교환) VS Shared memory(데이터 공유)
![](https://i.imgur.com/s5YJA8a.png)

1. Message Passing 커널(OS)가 memory protection을 위해 대리 전달을 해주는 일. 
	1. 장점 : 안전하고 동기화 문제가 없다.
	2. 단점 : 성능이 떨어진다.
2. Shared Memory : 두 프로세스 간 공유된 메모리를 생성 후 이용하는 것.
	1. 장점 : 성능이 좋다.
	2. 단점 : 동기화 문제

### IPC 설비
- 내부 프로세스 통신 시에도 그 상황에 맞는 설비를 선택하는 것이 중요하다.

- Message passing 모델 : PIPE, FIFO, Message Queue, Socket, Semaphore
    
- Shared Memory 모델 : 공유메모리, Memory Map

1. PIPE(PIPE)
2. Named PIPE(FIFO)
3. Message Queue
4. Shared Memory
5. Memory Map
6. Socket
7. Semaphore
